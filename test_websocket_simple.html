<!DOCTYPE html>
<html>
<head>
    <title>WebSocket æµ‹è¯•</title>
</head>
<body>
    <h1>WebSocket æµ‹è¯•</h1>
    <div id="log"></div>
    
    <script>
        const log = document.getElementById('log');
        
        function addLog(message) {
            log.innerHTML += '<p>' + new Date().toLocaleTimeString() + ': ' + message + '</p>';
        }
        
        addLog('å¼€å§‹è¿æ¥ WebSocket...');
        
        const ws = new WebSocket('ws://localhost:50000/ws');
        
        ws.onopen = function() {
            addLog('âœ… WebSocket è¿æ¥æˆåŠŸ');
            
            // å‘é€è®¤è¯æ¶ˆæ¯ï¼ˆä½¿ç”¨æ— æ•ˆä»¤ç‰Œæ¥æµ‹è¯•é”™è¯¯å¤„ç†ï¼‰
            const authMessage = {
                kind: 'cmd',
                type: 'auth',
                data: {
                    token: 'invalid-test-token'
                },
                cid: 'test-auth-1'
            };
            
            addLog('ğŸ“¤ å‘é€è®¤è¯æ¶ˆæ¯: ' + JSON.stringify(authMessage));
            ws.send(JSON.stringify(authMessage));
        };
        
        ws.onmessage = function(event) {
            addLog('ğŸ“¥ æ”¶åˆ°æ¶ˆæ¯: ' + event.data);
            
            try {
                const msg = JSON.parse(event.data);
                if (msg.kind === 'err' && msg.code === 'INVALID_TOKEN') {
                    addLog('âš ï¸ ä»¤ç‰Œæ— æ•ˆï¼ˆé¢„æœŸç»“æœï¼‰');
                    addLog('âœ… é‡è¦ï¼šæ²¡æœ‰å‡ºç° LazyInitializationExceptionï¼');
                    addLog('ğŸ‰ ä¿®å¤æˆåŠŸï¼');
                }
            } catch (e) {
                addLog('âŒ è§£ææ¶ˆæ¯å¤±è´¥: ' + e.message);
            }
        };
        
        ws.onerror = function(error) {
            addLog('âŒ WebSocket é”™è¯¯: ' + error);
        };
        
        ws.onclose = function() {
            addLog('ğŸ”Œ WebSocket è¿æ¥å…³é—­');
        };
    </script>
</body>
</html>